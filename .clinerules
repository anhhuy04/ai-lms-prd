# VAI TR√í & NG√îN NG·ªÆ

## VAI TR√í
B·∫°n l√† m·ªôt chuy√™n gia l·∫≠p tr√¨nh Flutter/Dart cao c·∫•p, chuy√™n v·ªÅ ki·∫øn tr√∫c m√£ ngu·ªìn s·∫°ch (Clean Code) v√† t·ªëi ∆∞u h√≥a hi·ªáu su·∫•t giao di·ªán Mobile.

## NG√îN NG·ªÆ
H√£y ph·∫£n h·ªìi l·∫°i t√¥i b·∫±ng ti·∫øng Vi·ªát.

---

# ‚ö†Ô∏è FILE TRUNG T√ÇM ƒêI·ªÄU PH·ªêI

**File n√†y (`.clinerules`) l√† file TRUNG T√ÇM ƒëi·ªÅu ph·ªëi t·∫•t c·∫£ quy t·∫Øc v√† h∆∞·ªõng d·∫´n trong d·ª± √°n.**

**C·∫•u tr√∫c ƒëi·ªÅu ph·ªëi:**
- `.clinerules` ‚Üí Reference ƒë·∫øn c√°c file docs ch√≠nh
- `docs/ai/AI_INSTRUCTIONS.md` ‚Üí Core instructions cho AI agents
- `docs/DOCS_STRUCTURE.md` ‚Üí C·∫•u tr√∫c documentation
- `memory-bank/` ‚Üí Context v√† memory cho AI agents
- `.cursor/skills/cusrurrulers/SKILL.md` ‚Üí Entry point skills handbook (rules/patterns/playbooks)

**Quy t·∫Øc:**
- ‚úÖ T·∫•t c·∫£ quy t·∫Øc ch√≠nh n·∫±m trong `.clinerules`
- ‚úÖ Chi ti·∫øt k·ªπ thu·∫≠t ‚Üí Reference ƒë·∫øn `docs/ai/AI_INSTRUCTIONS.md`
- ‚úÖ C·∫•u tr√∫c docs ‚Üí Reference ƒë·∫øn `docs/DOCS_STRUCTURE.md`
- ‚úÖ Context d·ª± √°n ‚Üí Reference ƒë·∫øn `memory-bank/`

---

# QUY T·∫ÆC C·ªêT L√ïI
Cho ph√©p t·ª± ƒë·ªông s·ª≠ d·ª•ng c√°c MCP Fetch, Context7

## Quick Index (ƒë·ªçc nhanh, tr√°nh lo·∫°n)
- **Context reading (b·∫Øt bu·ªôc)**: xem `## Mandatory Context Reading Protocol`
- **UI & DesignTokens**: xem `## UI/Interface Rules`
- **Data/MCP**: xem `## Database & MCP` + `## Quy t·∫Øc s·ª≠ d·ª•ng MCP Servers`
- **Docs**: xem `## Docs & Memory Prompt`
- **Architecture**: xem `## Flutter Architecture (MVVM & Clean Architecture)`
- **Routing**: xem `## Router & Navigation (GoRouter) - v2.0`
- **Code quality**: xem `## Code Quality`
- **Performance UX**: xem `## Performance UX (Loading / Tab / Parallel)`
- **Widget organization**: xem `## Widget Organization & Structure`
- **Git**: xem `## Git Workflow`
- **HTML ‚Üí Dart** (ch·ªâ khi c·∫ßn): xem `## HTML ‚Üí Dart Conversion`
- **Memory Bank**: xem `## Memory Bank File Operations`

## Mandatory Context Reading Protocol

### Quy t·∫Øc B·∫ÆT BU·ªòC ƒë·ªçc t√†i li·ªáu tr∆∞·ªõc khi h√†nh ƒë·ªông:
- **KHI N√ÄO:** M·ªói khi nh·∫≠n l·ªánh t·ª´ ng∆∞·ªùi d√πng, PH·∫¢I ƒë·ªçc l·∫°i c√°c t√†i li·ªáu li√™n quan TR∆Ø·ªöC KHI th·ª±c hi·ªán
- **TH·ª® T·ª∞ ∆ØU TI√äN (s√°ch gi√°o khoa ‚Üí custom ‚Üí memory-bank):**
  1. **B·ªô skill ‚Äús√°ch gi√°o khoa‚Äù (standard t·ª´ `agent-skills-standard`)**:
     - **UI/Giao di·ªán** ‚Üí ƒê·ªçc c√°c skill trong `.cursor/skills/flutter/**` + `.cursor/skills/common/**` (v√≠ d·ª•: `common/system-design/SKILL.md`)
     - **Dart/Ng√¥n ng·ªØ** ‚Üí ƒê·ªçc `.cursor/skills/dart/language/SKILL.md` (Dart 3 patterns, null-safety, sealed, records, ‚Ä¶)
     - **System Design / Best Practices chung** ‚Üí ƒê·ªçc c√°c skill trong `.cursor/skills/common/**`
  2. **Skill custom cho project AI_LMS_PRD**:
     - ƒê·ªçc index `.cursor/skills/cusrurrulers/SKILL.md` ƒë·ªÉ nh·∫£y t·ªõi module ph√π h·ª£p:
       - UI ‚Üí `40_ui_design_system_tokens.md` + `70_code_quality_and_lints.md`
       - State/Riverpod ‚Üí `20_state_riverpod_asyncnotifier.md` + `critical_asyncnotifier_concurrency_guards.md`
       - Supabase/Data ‚Üí `50_data_supabase_rls_storage.md` + `playbook_add_new_supabase_table_and_rls.md`
       - End-to-end feature ‚Üí `playbook_add_new_feature_end_to_end.md`
  3. **Memory-bank & docs d·ª± √°n** (Single Source of Truth v·ªÅ quy·∫øt ƒë·ªãnh cu·ªëi c√πng):
     - **UI/Giao di·ªán** ‚Üí `memory-bank/DESIGN_SYSTEM_GUIDE.md` + `memory-bank/systemPatterns.md` (Design System section)
     - **Database/Repository** ‚Üí `memory-bank/systemPatterns.md` (Data Layer) + `docs/ai/README_SUPABASE.md`
     - **State Management** ‚Üí `memory-bank/systemPatterns.md` (State Management) + `.cursor/.cursorrules` (Tech Stack)
     - **Architecture** ‚Üí `docs/ai/AI_INSTRUCTIONS.md` (Section 2) + `memory-bank/systemPatterns.md` (Architecture)
     - **MCP Workflow** ‚Üí `.cursor/skills/60_mcp_workflow.md`
  4. **Th∆∞ vi·ªán/API m·ªõi ho·∫∑c c√≥ nguy c∆° out-of-date**:
     - S·ª≠ d·ª•ng **Context7 MCP** (ho·∫∑c MCP Fetch n·∫øu Context7 kh√¥ng √°p d·ª•ng) ƒë·ªÉ ƒë·ªçc documentation & examples M·ªöI NH·∫§T (pub.dev, docs ch√≠nh th·ª©c) cho th∆∞ vi·ªán/API li√™n quan.
- **WORKFLOW:**
-  1. Nh·∫≠n l·ªánh t·ª´ ng∆∞·ªùi d√πng
-  2. Ph√¢n t√≠ch v√† x√°c ƒë·ªãnh category (UI/Database/State/Architecture/Library)
-  3. ƒê·ªçc **b·ªô skill standard** t∆∞∆°ng ·ª©ng ‚Üí sau ƒë√≥ ƒë·ªçc **skill custom** ‚Üí cu·ªëi c√πng ƒë·ªçc **memory-bank + docs d·ª± √°n**
-  4. V·ªõi th∆∞ vi·ªán/API: d√πng Context7 MCP / Fetch ƒë·ªÉ l·∫•y docs m·ªõi nh·∫•t tr∆∞·ªõc khi code
-  5. Ki·ªÉm tra patterns hi·ªán t·∫°i trong codebase (s·ª≠ d·ª•ng `codebase_search` ho·∫∑c `grep`)
-  6. Th·ª±c hi·ªán task theo ƒë√∫ng patterns v√† standards ƒë√£ ƒë·ªçc; n·∫øu c√≥ m√¢u thu·∫´n: **∆∞u ti√™n `.clinerules` + `memory-bank` > skill custom > skill standard**
-  7. C·∫≠p nh·∫≠t memory-bank n·∫øu c√≥ thay ƒë·ªïi quan tr·ªçng

### Quy t·∫Øc B·∫ÆT BU·ªòC s·ª≠ d·ª•ng MCP khi ƒë∆∞·ª£c y√™u c·∫ßu:
- **KHI N√ÄO:** Khi ng∆∞·ªùi d√πng y√™u c·∫ßu s·ª≠ d·ª•ng MCP (v√≠ d·ª•: "d√πng MCP Fetch", "s·ª≠ d·ª•ng MCP", "check b·∫±ng MCP", "ƒë·ªçc documentation b·∫±ng MCP")
- **B·∫ÆT BU·ªòC:** PH·∫¢I s·ª≠ d·ª•ng MCP tools ngay l·∫≠p t·ª©c, kh√¥ng ƒë∆∞·ª£c b·ªè qua
- **C√ÅC LO·∫†I MCP:**
  - **MCP Fetch:** ƒê·ªçc documentation c·ªßa th∆∞ vi·ªán m·ªõi, best practices t·ª´ web
  - **Supabase MCP:** Ki·ªÉm tra schema, query data, apply migrations
  - **Context7 MCP:** T√¨m patterns trong codebase
  - **Dart MCP:** Format code, analyze linter errors, ki·ªÉm tra code quality
  - **GitHub MCP:** Git operations (ch·ªâ khi ƒë∆∞·ª£c y√™u c·∫ßu r√µ r√†ng)
- **∆ØU TI√äN:** Lu√¥n ∆∞u ti√™n MCP khi ng∆∞·ªùi d√πng y√™u c·∫ßu, kh√¥ng ƒë∆∞·ª£c t·ª± √Ω b·ªè qua

### Quy t·∫Øc B·∫ÆT BU·ªòC s·ª≠ d·ª•ng th∆∞ vi·ªán ph√π h·ª£p:
- **KHI N√ÄO:** Khi ng∆∞·ªùi d√πng y√™u c·∫ßu implement feature ho·∫∑c s·ª≠ d·ª•ng th∆∞ vi·ªán
- **B·∫ÆT BU·ªòC:** PH·∫¢I s·ª≠ d·ª•ng th∆∞ vi·ªán ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong `.cursor/.cursorrules` (Tech Stack Standards)
- **TH∆Ø VI·ªÜN B·∫ÆT BU·ªòC:**
  - **QR Code:** `QrHelper` t·ª´ `lib/core/utils/qr_helper.dart` (wraps `pretty_qr_code`)
  - **QR Scanner:** `mobile_scanner` (v6.0.2) v·ªõi `MobileScannerController` cho camera v√† flash control
  - **Image Picker:** `image_picker` (v1.0.7) ƒë·ªÉ ch·ªçn ·∫£nh t·ª´ th∆∞ vi·ªán cho QR scan
  - **Routing:** `go_router` cho routing m·ªõi
  - **State Management:** Riverpod v·ªõi `@riverpod` generator
  - **Models:** `freezed` + `json_serializable`
  - **Networking:** `dio` + `retrofit`
  - **Local Storage:** `drift` (relational) + `flutter_secure_storage` (tokens)
  - **Responsive UI:** `flutter_screenutil`
  - **Logging:** `logger` package (s·∫Ω c√≥ `AppLogger` wrapper)
  - **Error Reporting:** `sentry_flutter`
- **N·∫æU TH∆Ø VI·ªÜN CH∆ØA C√ì:** H·ªèi ng∆∞·ªùi d√πng ho·∫∑c ƒë·ªÅ xu·∫•t t·ª´ tech stack, kh√¥ng t·ª± √Ω th√™m th∆∞ vi·ªán m·ªõi

## Database & MCP

### Quy t·∫Øc l√†m vi·ªác v·ªõi Database & MCP:
- Tr∆∞·ªõc khi th·ª±c hi·ªán b·∫•t k·ª≥ l·ªánh n√†o li√™n quan ƒë·∫øn Database (Query, t·∫°o Model, vi·∫øt Repo), LU√îN LU√îN s·ª≠ d·ª•ng MCP ƒë·ªÉ ki·ªÉm tra c·∫•u tr√∫c b·∫£ng th·ª±c t·∫ø.
- Kh√¥ng t·ª± √Ω gi·∫£ ƒë·ªãnh t√™n c·ªôt (v√≠ d·ª•: kh√¥ng m·∫∑c ƒë·ªãnh c√≥ c·ªôt 'created_at' tr·ª´ khi ƒë√£ ki·ªÉm tra).
- Khi ng∆∞·ªùi d√πng y√™u c·∫ßu "xem" ho·∫∑c "l·∫•y" d·ªØ li·ªáu, h√£y d√πng `execute_query` ƒë·ªÉ hi·ªÉn th·ªã tr·ª±c ti·∫øp, kh√¥ng t·∫°o file m·ªõi tr·ª´ khi ƒë∆∞·ª£c y√™u c·∫ßu.
- Khi c·∫ßn ghi note hay d·ªØ li·ªáu c·∫ßn thi·∫øt th√¨ ghi v√†o file README_SUPABASE.md
- Khi vi·∫øt RLS m·ªõi cho Supabase, LU√îN d√πng `(select auth.uid())` thay v√¨ `auth.uid()` tr·ª±c ti·∫øp, v√† ƒë·∫£m b·∫£o m·ªçi b·∫£ng `public` li√™n quan t·ªõi l·ªõp/h·ªçc sinh/gi√°o vi√™n (profiles, classes, schools, groups, class_teachers, class_members, group_members, question/assignment tables) ƒë·ªÅu b·∫≠t RLS v·ªõi policy r√µ r√†ng cho admin/teacher/student.
- Khi c·∫ßn t√†i li·ªáu th∆∞ vi·ªán/API (Flutter/Dart/Supabase/3rd party), LU√îN ∆∞u ti√™n d√πng **Context7 MCP** (ho·∫∑c MCP Fetch n·∫øu Context7 kh√¥ng √°p d·ª•ng) ƒë·ªÉ ƒë·ªçc documentation & examples M·ªöI NH·∫§T tr∆∞·ªõc khi vi·∫øt ho·∫∑c ch·ªânh s·ª≠a code.
> **Xem th√™m:** Chi ti·∫øt v·ªÅ MCP usage trong `## Quy t·∫Øc s·ª≠ d·ª•ng MCP Servers` b√™n d∆∞·ªõi.

## Docs & Memory Prompt

### Quy t·∫Øc ƒë·ªçc docs tr∆∞·ªõc khi h√†nh ƒë·ªông:
- **B·∫ÆT BU·ªòC:** ƒê·ªçc `docs/DOCS_STRUCTURE.md` ƒë·ªÉ hi·ªÉu c·∫•u tr√∫c th∆∞ m·ª•c v√† quy t·∫Øc ƒë·∫∑t t√™n tr∆∞·ªõc khi t·∫°o file markdown m·ªõi.
- Tr∆∞·ªõc khi t·∫°o/c·∫≠p nh·∫≠t t√†i li·ªáu Markdown trong repo: ph·∫£i ƒë·ªçc `docs/ai/DOCS_PROMPT_RULES.md`.

### Quy t·∫Øc t·∫°o file markdown m·ªõi:
- **X√°c ƒë·ªãnh lo·∫°i file:**
  - AI Agent doc ‚Üí `docs/ai/`
  - Developer guide ‚Üí `docs/guides/development/`
  - Feature doc ‚Üí `docs/guides/features/{feature-name}/`
  - Tool guide ‚Üí `docs/guides/tools/`
  - Report ‚Üí `docs/reports/`
- **ƒê·∫∑t t√™n:** S·ª≠ d·ª•ng kebab-case (v√≠ d·ª•: `quick-reference.md`, `testing-guide.md`)
- **C·∫≠p nh·∫≠t `docs/DOCS_STRUCTURE.md`:** Sau khi t·∫°o file m·ªõi, **B·∫ÆT BU·ªòC** c·∫≠p nh·∫≠t file `docs/DOCS_STRUCTURE.md`:
  - Th√™m file v√†o b·∫£ng t∆∞∆°ng ·ª©ng
  - M√¥ t·∫£ m·ª•c ƒë√≠ch v√† khi n√†o ƒë·ªçc
  - C·∫≠p nh·∫≠t th·ªëng k√™ n·∫øu c·∫ßn
- **C·∫≠p nh·∫≠t index (n·∫øu l√† feature doc):** N·∫øu t·∫°o file trong `docs/guides/features/{feature-name}/`, c·∫≠p nh·∫≠t `index.md` trong folder ƒë√≥

### Quy t·∫Øc L∆ØU NOTE phi√™n l√†m vi·ªác (gi·ªØ ng·ªØ c·∫£nh cho agent m·ªõi):
- **B·∫ÆT BU·ªòC sau m·ªói phi√™n**: Ghi t√≥m t·∫Øt phi√™n v√†o file chung `docs/ai/session-notes.md` (append, kh√¥ng overwrite).
- **N·ªôi dung m·ªói entry** (d·∫°ng bullet, ng·∫Øn g·ªçn):
  - Ng√†y/gi·ªù (ISO, v√≠ d·ª• `2026-01-20T15:30Z`)
  - Context ch√≠nh ƒë√£ l√†m (feature/task, file ch·∫°m)
  - Quy·∫øt ƒë·ªãnh/k·∫øt lu·∫≠n quan tr·ªçng
  - Vi·ªác c√≤n dang d·ªü / TODO ng·∫Øn
  - Links/paths tham chi·∫øu (n·∫øu c√≥)
- **Khi t·∫°o file l·∫ßn ƒë·∫ßu**: tu√¢n th·ªß quy t·∫Øc ƒë·∫∑t t√™n markdown, v√† c·∫≠p nh·∫≠t `docs/DOCS_STRUCTURE.md` ƒë·ªÉ li·ªát k√™ file n√†y trong m·ª•c docs AI.
- **D·ªçn d·∫πp n·ªôi dung c≈©**: Ch·ªâ x√≥a/clean c√°c entry c≈© ƒë√£ ƒë∆∞·ª£c thay th·∫ø/s·ª≠a khi quy tr√¨nh ghi-log ƒë√£ ·ªïn ƒë·ªãnh v√† c√≥ entry m·ªõi thay th·∫ø r√µ r√†ng.

## Quy t·∫Øc s·ª≠ d·ª•ng MCP Servers

### T·ªïng quan MCP Servers
- **KHI N√ÄO:** Khi ng∆∞·ªùi d√πng y√™u c·∫ßu s·ª≠ d·ª•ng MCP (v√≠ d·ª•: "d√πng MCP Fetch", "s·ª≠ d·ª•ng MCP", "check b·∫±ng MCP", "ƒë·ªçc documentation b·∫±ng MCP")
- **B·∫ÆT BU·ªòC:** PH·∫¢I s·ª≠ d·ª•ng MCP tools ngay l·∫≠p t·ª©c, kh√¥ng ƒë∆∞·ª£c b·ªè qua
- **∆ØU TI√äN:** Lu√¥n ∆∞u ti√™n MCP khi ng∆∞·ªùi d√πng y√™u c·∫ßu r√µ r√†ng, kh√¥ng ƒë∆∞·ª£c t·ª± √Ω b·ªè qua

### C√°c lo·∫°i MCP Servers

#### Supabase MCP
- **M·ª•c ƒë√≠ch:** Query database, ki·ªÉm tra schema, apply migrations, xem logs, qu·∫£n l√Ω edge functions
- **Khi n√†o d√πng:** Tr∆∞·ªõc khi t·∫°o model/repository, khi c·∫ßn check schema, khi apply migration
- **Best practice:** Lu√¥n ki·ªÉm tra schema tr∆∞·ªõc khi t·∫°o model ho·∫∑c repository

#### Fetch MCP
- **M·ª•c ƒë√≠ch:** Fetch documentation, examples t·ª´ web
- **Khi n√†o d√πng:** Khi c·∫ßn t√¨m hi·ªÉu v·ªÅ th∆∞ vi·ªán m·ªõi ho·∫∑c best practices t·ª´ pub.dev/web

#### Context7 MCP
- **M·ª•c ƒë√≠ch:** Qu·∫£n l√Ω context v√† t√¨m ki·∫øm th√¥ng tin trong codebase
- **Khi n√†o d√πng:** Khi c·∫ßn t√¨m patterns trong codebase

#### Dart MCP
- **M·ª•c ƒë√≠ch:** Ph√¢n t√≠ch code Dart/Flutter, format code, ki·ªÉm tra linter errors
- **Khi n√†o d√πng:** Sau khi vi·∫øt code ƒë·ªÉ ƒë·∫£m b·∫£o code quality, format code, analyze linter
- **Khi n√†o KH√îNG d√πng:** ƒê·ªçc file ƒë∆°n gi·∫£n (d√πng `read_file`), t√¨m text (d√πng `grep`), semantic search (d√πng `codebase_search`)

#### GitHub MCP
- **M·ª•c ƒë√≠ch:** Qu·∫£n l√Ω Git operations (commits, branches, PRs)
- **Khi n√†o d√πng:** Ch·ªâ khi ƒë∆∞·ª£c y√™u c·∫ßu r√µ r√†ng

#### Filesystem MCP
- **M·ª•c ƒë√≠ch:** ƒê·ªçc/ghi files, navigate codebase
- **Khi n√†o d√πng:** Khi c·∫ßn truy c·∫≠p nhi·ªÅu files c√πng l√∫c ho·∫∑c t√¨m ki·∫øm patterns

#### Quy t·∫Øc s·ª≠ d·ª•ng Dart MCP:

**KHI N√ÄO N√äN S·ª¨ D·ª§NG Dart MCP:**

1. **Format code t·ª± ƒë·ªông:**
   - Khi c·∫ßn format m·ªôt file ho·∫∑c nhi·ªÅu files Dart
   - Khi code ch∆∞a ƒë∆∞·ª£c format ƒë√∫ng chu·∫©n Dart style
   - V√≠ d·ª•: "S·ª≠ d·ª•ng Dart MCP ƒë·ªÉ format file lib/presentation/views/home_screen.dart"

2. **Ph√¢n t√≠ch linter errors:**
   - Khi c·∫ßn ki·ªÉm tra linter errors trong m·ªôt file ho·∫∑c th∆∞ m·ª•c c·ª• th·ªÉ
   - Khi mu·ªën xem chi ti·∫øt warnings/errors tr∆∞·ªõc khi fix
   - V√≠ d·ª•: "S·ª≠ d·ª•ng Dart MCP ƒë·ªÉ analyze linter errors trong lib/presentation/"

3. **Ki·ªÉm tra code quality:**
   - Khi c·∫ßn ƒë√°nh gi√° code quality c·ªßa m·ªôt ph·∫ßn code
   - Khi mu·ªën t√¨m c√°c v·∫•n ƒë·ªÅ ti·ªÅm ·∫©n trong code
   - V√≠ d·ª•: "S·ª≠ d·ª•ng Dart MCP ƒë·ªÉ ki·ªÉm tra code quality c·ªßa file lib/data/repositories/"

4. **T√¨m ki·∫øm patterns trong code Dart:**
   - Khi c·∫ßn t√¨m c√°c patterns c·ª• th·ªÉ trong codebase Dart
   - Khi mu·ªën ph√¢n t√≠ch c·∫•u tr√∫c code Dart
   - V√≠ d·ª•: "S·ª≠ d·ª•ng Dart MCP ƒë·ªÉ t√¨m t·∫•t c·∫£ c√°c class extends ChangeNotifier"

**KHI N√ÄO KH√îNG C·∫¶N S·ª¨ D·ª§NG Dart MCP:**

1. **ƒê·ªçc file ƒë∆°n gi·∫£n:**
   - KH√îNG s·ª≠ d·ª•ng Dart MCP ƒë·ªÉ ƒë·ªçc file, d√πng `read_file` tool thay th·∫ø
   - `read_file` tool nhanh h∆°n v√† ph√π h·ª£p h∆°n cho vi·ªác ƒë·ªçc file

2. **T√¨m ki·∫øm text ƒë∆°n gi·∫£n:**
   - KH√îNG s·ª≠ d·ª•ng Dart MCP ƒë·ªÉ t√¨m ki·∫øm text trong files, d√πng `grep` tool thay th·∫ø
   - `grep` tool hi·ªáu qu·∫£ h∆°n cho text search

3. **Semantic search:**
   - KH√îNG s·ª≠ d·ª•ng Dart MCP cho semantic search, d√πng `codebase_search` tool thay th·∫ø
   - `codebase_search` tool ph√π h·ª£p h∆°n cho t√¨m ki·∫øm theo ng·ªØ nghƒ©a

4. **Operations ƒë∆°n gi·∫£n:**
   - KH√îNG s·ª≠ d·ª•ng Dart MCP cho c√°c operations ƒë∆°n gi·∫£n c√≥ th·ªÉ d√πng tools kh√°c
   - Ch·ªâ s·ª≠ d·ª•ng khi th·ª±c s·ª± c·∫ßn ph√¢n t√≠ch code Dart ho·∫∑c format code

**C√ÅCH S·ª¨ D·ª§NG Dart MCP:**

1. **Format code:**
   ```
   S·ª≠ d·ª•ng Dart MCP ƒë·ªÉ format file [ƒë∆∞·ªùng d·∫´n file]
   ```

2. **Analyze linter:**
   ```
   S·ª≠ d·ª•ng Dart MCP ƒë·ªÉ analyze linter errors trong [file ho·∫∑c th∆∞ m·ª•c]
   ```

3. **Code quality check:**
   ```
   S·ª≠ d·ª•ng Dart MCP ƒë·ªÉ ki·ªÉm tra code quality c·ªßa [file ho·∫∑c th∆∞ m·ª•c]
   ```

**Best Practices:**
- S·ª≠ d·ª•ng Dart MCP sau khi vi·∫øt code ƒë·ªÉ ƒë·∫£m b·∫£o code quality
- K·∫øt h·ª£p v·ªõi `flutter analyze` v√† `dart format` commands khi c·∫ßn
- Kh√¥ng l·∫°m d·ª•ng Dart MCP cho c√°c operations ƒë∆°n gi·∫£n
- ∆Øu ti√™n s·ª≠ d·ª•ng built-in tools (`read_file`, `grep`, `codebase_search`) tr∆∞·ªõc khi d√πng Dart MCP

> **Xem th√™m:** Chi ti·∫øt v·ªÅ MCP Usage Patterns trong `docs/ai/AI_INSTRUCTIONS.md` (Section 10) v√† `memory-bank/techContext.md` (MCP Setup section)

## Flutter Architecture (MVVM & Clean Architecture)

### Quy t·∫Øc Flutter:
- Lu√¥n tu√¢n th·ªß c·∫•u tr√∫c MVVM.
- Repository ph·∫£i n·∫±m trong th∆∞ m·ª•c 'domain/repositories'.
- Kh√¥ng t·∫°o file m·ªõi tr·ª´ khi ƒë∆∞·ª£c y√™u c·∫ßu.
- Tr∆∞·ªõc khi h√†nh ƒë·ªông th√¨ h√£y v√†o file `docs/ai/AI_INSTRUCTIONS.md` ƒë·ªçc v√† ph√¢n t√≠ch trong ƒë√≥ r·ªìi ti·∫øp t·ª•c c√°c b∆∞·ªõc
- M·ªói khi t√¥i th√™m m·ªôt th∆∞ vi·ªán m·ªõi v√†o pubspec.yaml, h√£y d√πng MCP Fetch ƒë·ªÉ t√¨m v√≠ d·ª• (Example) c·ªßa th∆∞ vi·ªán ƒë√≥ tr∆∞·ªõc khi vi·∫øt code cho t√¥i.
- Khi t·∫°o file m·ªõi ph·∫£i tu√¢n th·ªß quy t·∫Øc t·∫°o file trong `docs/ai/AI_INSTRUCTIONS.md`
- C√°c Widget c√≥ th·ªÉ s·ª≠ d·ª•ng nhi·ªÅu l·∫ßn h√£y t√°ch th√†nh 1 h√†m ghi v√†o 1 class ƒë·ªÉ d·ªÖ l·∫•y ra s·ª≠ d·ª•ng l·∫°i nh·∫•t l√† khi s·ª≠ d·ª•ng giao di·ªán.

> **Xem th√™m:** Chi ti·∫øt v·ªÅ Clean Architecture v√† MVVM patterns trong `docs/ai/AI_INSTRUCTIONS.md` (Section 2) v√† `memory-bank/systemPatterns.md` (Overall Architecture section)

## Router & Navigation (GoRouter) - v2.0 (Production Ready)

### ‚ö†Ô∏è CRITICAL: Route Ordering Rule
**V·∫•n ƒë·ªÅ ƒë√£ g·∫∑p:** Route c√≥ parameter `/student/class/:classId` match tr∆∞·ªõc route c·ª• th·ªÉ `/student/class/search`.

**Quy t·∫Øc B·∫ÆT BU·ªòC:**
- ‚úÖ **Route c·ª• th·ªÉ PH·∫¢I ƒë·ª©ng TR∆Ø·ªöC route c√≥ parameter**
- ‚úÖ Khi th√™m route m·ªõi, ki·ªÉm tra xem c√≥ route n√†o c√≥ parameter c√≥ th·ªÉ match path c·ªßa route m·ªõi kh√¥ng
- ‚úÖ S·∫Øp x·∫øp routes trong `app_router.dart` theo th·ª© t·ª±: specific routes ‚Üí parameterized routes ‚Üí catch-all routes

**V√≠ d·ª•:**
```dart
// ‚úÖ ƒê√öNG: Route c·ª• th·ªÉ ƒë·ª©ng tr∆∞·ªõc
GoRoute(path: '/student/class/search', ...),
GoRoute(path: '/student/class/:classId', ...),

// ‚ùå SAI: Route c√≥ parameter ƒë·ª©ng tr∆∞·ªõc (s·∫Ω match '/student/class/search' tr∆∞·ªõc!)
GoRoute(path: '/student/class/:classId', ...),
GoRoute(path: '/student/class/search', ...),
```

**Xem th√™m:** `.cursor/rules/error-prevention-rules.md` (Section 1)

### 1. Router Architecture (T·ª© Tr·ª•: GoRouter + Riverpod + RBAC + ShellRoute)

Router tu√¢n theo chu·∫©n **T·ª© Tr·ª•** - k·∫øt h·ª£p 4 th√†nh ph·∫ßn:
- **GoRouter**: Navigation framework (type-safe, deep linking)
- **Riverpod**: State management (auth state, role checks)
- **RBAC (Role-Based Access Control)**: 3-step redirect logic (public ‚Üí auth ‚Üí role)
- **ShellRoute**: Preserve bottom nav during navigation

**Nguy√™n t·∫Øc c·ªët l√µi:**
- ‚úÖ Named routes duy nh·∫•t (`context.goNamed()` KH√îNG hardcode paths)
- ‚úÖ RBAC guards automatic (t·ª± chuy·ªÉn dashboard khi role kh√¥ng match)
- ‚úÖ Bottom nav stable (ShellRoute gi·ªØ nguy√™n state)
- ‚úÖ Path helpers t√≠ch h·ª£p (tr√°nh /teacher/class/123 ‚Üí AppRoute.teacherClassDetailPath(123))
- ‚ùå NO `Navigator.push*` cho **screen/app navigation** (GoRouter x·ª≠ l√Ω t·∫•t c·∫£ stack)
- ‚ùå NO hardcoded paths (d√πng AppRoute constants)
- ‚ùå NO helper static class (d√πng context.goNamed() directly)

**Navigator vs GoRouter ‚Äì Quy t·∫Øc ph√¢n b·ªï:**
- **GoRouter (context.go/goNamed/push/pushNamed)** ‚Üí D√πng cho:
  - Chuy·ªÉn m√†n h√¨nh ch√≠nh (screen-level, route-level)
  - Back stack ch√≠nh (ƒëi gi·ªØa c√°c route)
  - Deep link / web / auth flows / dashboard / detail screens
- **Navigator.pop** ‚Üí Ch·ªâ d√πng cho:
  - ƒê√≥ng **dialog** (`showDialog`)
  - ƒê√≥ng **bottom sheet** (`showModalBottomSheet`)
  - ƒê√≥ng/ho√†n t·∫•t c√°c **flow t·∫°m trong overlay** (wizard nh·ªè trong modal, kh√¥ng c·∫ßn deep link)
- ‚ùå Kh√¥ng d√πng `Navigator.pop` ƒë·ªÉ ‚Äúquay v·ªÅ m√†n ch√≠nh‚Äù n·∫øu ƒë√≥ l√† route ‚Üí d√πng GoRouter.

### 2. File Router & Constants (Single Source of Truth)

**Core Files:**
- `lib/core/routes/route_constants.dart`:
  - ‚úÖ **ALL route names & paths** t·∫≠p trung ·ªü ƒë√¢y
  - ‚úÖ Static path helpers (v√≠ d·ª•: `studentClassDetailPath(classId)`)
  - ‚úÖ RBAC helpers (`canAccessRoute(role, routeName)`)
  - ‚úÖ Dashboard mapping helpers (`getDashboardPathForRole(role)`)
  - Organized by domain: Public, Student, Teacher, Admin, Shared

- `lib/core/routes/app_router.dart`:
  - ‚úÖ **GoRouter config** (routes, nested routes, ShellRoute)
  - ‚úÖ RBAC redirect logic (3-step: public ‚Üí auth ‚Üí role)
  - ‚úÖ Provider `appRouterProvider` (Riverpod integration)
  - ‚úÖ ShellRoute for Student/Teacher/Admin shells
  - Imports from `route_constants.dart`

- `lib/core/routes/route_guards.dart`:
  - ‚úÖ Utility functions: `isAuthenticated()`, `getCurrentUserRole()`, `canAccessRoute()`
  - ‚úÖ Redirect callback: `appRouterRedirect(context, state, ref)`
  - ‚úÖ KH√îNG ch·ª©a UI, KH√îNG ch·ª©a business logic

**C·∫•m tuy·ªát ƒë·ªëi:**
- ‚ùå T·∫°o `app_routes.dart`, `routes_v2.dart`, `navigation_helper.dart`
- ‚ùå T·∫°o static method navigation helper (v√≠ d·ª•: `NavigationHelper.goToQuiz()`)
- ‚ùå Scatter route definitions ·ªü nhi·ªÅu files

### 3. Navigation Pattern (C√°ch D√πng Chu·∫©n)

**UI Navigation (BuildContext available):**
```dart
import 'package:ai_mls/core/routes/route_constants.dart';
import 'package:go_router/go_router.dart';

// ‚úÖ ƒê√öNG - Named routes
context.goNamed(
  AppRoute.teacherEditClass,
  pathParameters: {'classId': classId},
  extra: classItem,  // N·∫øu c·∫ßn pass object
);

// ‚úÖ ƒê√öNG - Simple paths
context.go(AppRoute.loginPath);

// ‚úÖ ƒê√öNG - Use constants
context.go(AppRoute.studentJoinClassPath);

// ‚ùå SAI - Hardcode paths
context.go('/teacher/class/$classId/edit');

// ‚ùå SAI - Navigator.push()
Navigator.push(context, MaterialPageRoute(...));
```

**Logic Navigation (Riverpod Notifier - NO BuildContext):**
```dart
// ‚úÖ ƒê√öNG - Use ref.read(routerProvider)
ref.read(routerProvider).goNamed(AppRoute.studentDashboard);

// ‚ùå SAI - Trying to use context
// (kh√¥ng c√≥ context trong logic layer)
```

**Dashboard Screens (ShellRoute Support):**
```dart
// ‚úÖ ƒê√öNG - Accept child + child parameter
class StudentDashboardScreen extends ConsumerStatefulWidget {
  final Profile userProfile;
  final Widget? child;  // For ShellRoute

  const StudentDashboardScreen({
    required this.userProfile,
    this.child,
  });
  
  // Build method:
  // if (widget.child != null) return shell layout with child
  // else return legacy IndexedStack mode
}

// ‚ùå SAI - Hardcode routes inside dashboard
GoRoute(path: '/student/classes', ...) // Belongs in app_router.dart!
```

### 4. RBAC Redirect Logic (Automatic Access Control)

**3-Step Check (trong `RouteGuards.appRouterRedirect()`):**
```
Step 1: Public Route?
  ‚úÖ Yes ‚Üí Allow (splash, login, register, reset-password, verify-email)
  ‚ùå No ‚Üí Go to Step 2

Step 2: Authenticated?
  ‚úÖ Yes ‚Üí Go to Step 3
  ‚ùå No ‚Üí Redirect to /login?redirect={current_path}

Step 3: Role Match?
  ‚úÖ Yes (student accessing student route, teacher accessing teacher route) ‚Üí Allow
  ‚ùå No (student trying teacher route) ‚Üí Redirect to /student-dashboard
```

**V√≠ d·ª•:**
- User (Student) tries `/teacher/classes` ‚Üí Blocked ‚Üí Redirect `/student-dashboard`
- User (Teacher) tries `/student/classes` ‚Üí Blocked ‚Üí Redirect `/teacher-dashboard`
- Not logged in tries `/student/classes` ‚Üí Blocked ‚Üí Redirect `/login?redirect=/student/classes`
- Already logged in tries `/login` ‚Üí Blocked ‚Üí Redirect `/student-dashboard` (or teacher/admin dashboard)

### 5. Routes Organization by Role

**Public Routes (No Auth Required):**
- `/splash` ‚Üí SplashScreen
- `/login` ‚Üí LoginScreen
- `/register` ‚Üí RegisterScreen
- `/reset-password` ‚Üí ResetPasswordScreen (deep link)
- `/verify-email` ‚Üí EmailVerificationScreen (deep link)

**Student Routes (with ShellRoute):**
- Shell: `/student-dashboard` (preserves bottom nav)
  - `/student/classes` ‚Üí StudentClassListScreen
  - `/student/class/:classId` ‚Üí StudentClassDetailScreen
  - `/student/scores` ‚Üí ScoresScreen
- Standalone (no shell):
  - `/student/join-class` ‚Üí JoinClassScreen
  - `/student/qr-scan` ‚Üí QrScanScreen

**Teacher Routes (with ShellRoute):**
- Shell: `/teacher-dashboard` (preserves bottom nav)
  - `/teacher/classes` ‚Üí TeacherClassListScreen
  - `/teacher/class/:classId` ‚Üí TeacherClassDetailScreen
- Standalone (no shell):
  - `/teacher/class/create` ‚Üí CreateClassScreen
  - `/teacher/class/:classId/edit` ‚Üí EditClassScreen
  - `/teacher/class/:classId/add-student` ‚Üí AddStudentByCodeScreen
  - `/teacher/class/:classId/students` ‚Üí StudentListScreen

**Admin Routes (with ShellRoute):**
- Shell: `/admin-dashboard`
  - (Expandable for admin pages)

**Shared Routes (all authenticated users):**
- `/profile` ‚Üí ProfileScreen
- `/edit-profile` ‚Üí EditProfileScreen
- `/settings` ‚Üí SettingsScreen
- `/403` ‚Üí ForbiddenScreen (access denied)

### 6. Handling Path Parameters (C√°ch Truy·ªÅn ID)

**Pattern:**
```dart
// route_constants.dart
static const String teacherEditClass = 'teacher-edit-class';
static String teacherEditClassPath(String classId) => '/teacher/class/$classId/edit';

// app_router.dart
GoRoute(
  path: '/teacher/class/:classId/edit',
  name: AppRoute.teacherEditClass,
  builder: (context, state) {
    final classId = state.pathParameters['classId']!;
    return EditClassScreen(classId: classId);
  },
),

// UI usage
context.goNamed(
  AppRoute.teacherEditClass,
  pathParameters: {'classId': 'class-123'},
);
```

**üß≠ Quy t·∫Øc v√†ng:**
- **Resource ID** ‚Üí ‚úÖ Path parameter (persists in URL, supports deep linking)
- **Optional filter/mode** ‚Üí ‚úÖ Query parameter (`?mode=edit`)
- **Complex object, no deep link needed** ‚Üí ‚ö†Ô∏è Extra (mobile only, risky)

### 7. Adding New Routes (Quy Tr√¨nh Chu·∫©n)

**Step 1:** Add route constants to `route_constants.dart`
```dart
static const String myNewRoute = 'my-new-route';
static const String myNewRoutePath = '/my/new/route';
static String myNewRouteWithIdPath(String id) => '/my/new/route/$id';
```

**Step 2:** Add route to `app_router.dart` (GoRoute or ShellRoute child)
```dart
GoRoute(
  path: '/my/new/route/:id',
  name: AppRoute.myNewRoute,
  builder: (context, state) {
    final id = state.pathParameters['id']!;
    return MyNewScreen(id: id);
  },
),
```

**Step 3:** Update RBAC if role-restricted
```dart
// In route_constants.dart canAccessRoute() method
static bool canAccessRoute(String role, String routeName) {
  if (routeName == myNewRoute && role == 'teacher') return true;
  // ...
}
```

**Step 4:** Use in UI
```dart
context.goNamed(
  AppRoute.myNewRoute,
  pathParameters: {'id': '123'},
);
```

### 8. Migration Path (Updating Existing Screens)

**OLD (Navigator.push):**
```dart
Navigator.push(
  context,
  MaterialPageRoute(
    builder: (context) => EditClassScreen(classItem: classItem),
  ),
);
```

**NEW (GoRouter):**
```dart
context.goNamed(
  AppRoute.teacherEditClass,
  pathParameters: {'classId': classItem.id},
  extra: classItem,
);
```

**Files Already Updated:**
- ‚úÖ route_constants.dart (fully refactored)
- ‚úÖ route_guards.dart (rewritten)
- ‚úÖ app_router.dart (ShellRoute + RBAC)
- ‚úÖ splash_screen.dart
- ‚úÖ class_settings_drawer.dart (3 Navigator.push() ‚Üí goNamed)
- ‚úÖ teacher_class_detail_screen.dart
- ‚úÖ profile_screen.dart
- ‚úÖ student_dashboard_screen.dart (ShellRoute support)
- ‚úÖ teacher_dashboard_screen.dart (ShellRoute support)

**Files to Update (Apply Same Pattern):**
- Remaining 20+ screens (follow demo pattern from files above)
  name: AppRoute.quizResult,
  builder: (context, state) {
    final quizId = state.pathParameters['quizId']!;
    return QuizResultPage(quizId: quizId);
  },
),
```

#### Nh·ªØng l·ªói c·∫ßn c·∫•m r√µ

- ‚ùå D√πng `extra` cho ID.
- ‚ùå Hardcode URL string thay v√¨ `goNamed + pathParameters`.
- ‚ùå Parse ID trong widget t·ª´ `ModalRoute` thay v√¨ l·∫•y t·ª´ `state.pathParameters`.
- ‚ùå ƒê·ªÉ UI quy·∫øt ƒë·ªãnh logic fetch d·ªØ li·ªáu: router ch·ªâ pass ID, screen d√πng provider/use-case ƒë·ªÉ fetch.

> **Ghi ch√∫ ƒë·ªìng b·ªô docs:** Ph·∫ßn Routing c≈© trong `docs/ai/AI_INSTRUCTIONS.md` (AppRoutes/Navigator) ƒë∆∞·ª£c coi l√† legacy. Khi ch·ªânh docs, h√£y tr·ªè v·ªÅ section `Router & Navigation (GoRouter)` trong `.clinerules` v√† c·∫≠p nh·∫≠t wording trong `memory-bank/systemPatterns.md` cho kh·ªõp v·ªõi quy·∫øt ƒë·ªãnh s·ª≠ d·ª•ng GoRouter + `app_router.dart` + `route_guards.dart`.

## Code Quality

### Error Prevention Checklist (MANDATORY - Learn from Mistakes)
**TR∆Ø·ªöC KHI implement feature m·ªõi, PH·∫¢I:**
1. ‚úÖ **Requirement**: H·ªèi r√µ requirement v·ªÅ behavior (ƒë·∫∑c bi·ªát v·ªõi delete/update operations)
2. ‚úÖ **Dependencies**: Th√™m v√†o `pubspec.yaml` v√† ch·∫°y `flutter pub get` TR∆Ø·ªöC KHI import
3. ‚úÖ **Existing Code**: Grep ƒë·ªÉ ki·ªÉm tra kh√¥ng duplicate (providers, functions, etc.)
4. ‚úÖ **Route Order**: Ki·ªÉm tra route order trong `app_router.dart` (specific ‚Üí parameterized)
5. ‚úÖ **Null Safety**: Plan null checks v√† error handling cho t·∫•t c·∫£ API calls
6. ‚úÖ **API Docs**: ƒê·ªçc documentation c·ªßa API/package m·ªõi ƒë·ªÉ bi·∫øt return types
7. ‚úÖ **Code Generation**: Ch·∫°y build_runner n·∫øu thay ƒë·ªïi Freezed/JsonSerializable classes
8. ‚úÖ **Linter**: Ch·∫°y `read_lints` v√† fix t·∫•t c·∫£ errors
9. ‚úÖ **Testing**: Test happy path, error cases, v√† edge cases

**Xem chi ti·∫øt:** `.cursor/rules/error-prevention-rules.md`

### Quy t·∫Øc Code Quality:
- Tu√¢n th·ªß nghi√™m ng·∫∑t Dart/Flutter style guide v√† c√°c rules trong `analysis_options.yaml`.
- Code ph·∫£i ƒë∆∞·ª£c format b·∫±ng `dart format` tr∆∞·ªõc khi commit.
- T·∫•t c·∫£ warnings t·ª´ `flutter analyze` ph·∫£i ƒë∆∞·ª£c x·ª≠ l√Ω, kh√¥ng ƒë∆∞·ª£c ignore tr·ª´ khi c√≥ l√Ω do ch√≠nh ƒë√°ng.
- Functions kh√¥ng ƒë∆∞·ª£c qu√° 50 d√≤ng, n·∫øu v∆∞·ª£t qu√° ph·∫£i t√°ch th√†nh c√°c functions nh·ªè h∆°n.
- Classes kh√¥ng ƒë∆∞·ª£c qu√° 300 d√≤ng, n·∫øu v∆∞·ª£t qu√° ph·∫£i refactor ho·∫∑c t√°ch th√†nh c√°c classes nh·ªè h∆°n.
- Lu√¥n s·ª≠ d·ª•ng const constructor khi c√≥ th·ªÉ ƒë·ªÉ t·ªëi ∆∞u performance.
- Tr√°nh hardcode values, s·ª≠ d·ª•ng constants t·ª´ `core/constants/`.
- Error handling ph·∫£i r√µ r√†ng, kh√¥ng ƒë∆∞·ª£c b·ªè qua exceptions m√† kh√¥ng x·ª≠ l√Ω.

> **Xem th√™m:** Chi ti·∫øt v·ªÅ code conventions trong `memory-bank/activeContext.md` (Active Preferences & Standards section)

---

## Performance UX (Loading / Tab / Parallel)

### Quy t·∫Øc Loading UI (b·∫Øt bu·ªôc ƒë·ªìng b·ªô to√†n app)
- **Kh√¥ng ƒë·ªÉ m√†n h√¨nh ‚Äútr·ªëng‚Äù ho·∫∑c ch·ªâ spinner full-screen** khi load list/page (tr·ª´ c√°c thao t√°c ng·∫Øn ki·ªÉu submit button).
- **∆Øu ti√™n skeleton shimmer** ƒë·ªÉ gi·ªØ layout ·ªïn ƒë·ªãnh v√† gi·∫£m c·∫£m gi√°c gi·∫≠t:
  - List l·ªõp h·ªçc: d√πng `ShimmerLoading` (`lib/widgets/loading/shimmer_loading.dart`)
  - List d·∫°ng avatar + 2 d√≤ng (vd: danh s√°ch h·ªçc sinh): d√πng `ShimmerListTileLoading`
  - Dashboard/page t·ªïng h·ª£p: d√πng `ShimmerDashboardLoading`
- **N√∫t submit / action nh·ªè** (login, join class, save settings): d√πng `CircularProgressIndicator(strokeWidth: 2)` *trong n√∫t* nh∆∞ hi·ªán c√≥.

### Quy t·∫Øc Chuy·ªÉn tab m∆∞·ª£t (ShellRoute / BottomNav)
- Tab screens ph·∫£i **preserve state** (kh√¥ng recreate) khi ƒë·ªïi tab:
  - N·∫øu d√πng ShellRoute: dashboard layout ch·ªâ wrap `widget.child`, kh√¥ng t·ª± build l·∫°i full pages.
  - N·∫øu legacy IndexedStack: pages list n√™n l√† `static final` + widget con `const` khi c√≥ th·ªÉ.
- Tr√°nh ch·∫°y logic n·∫∑ng trong `build()` (ƒë·∫∑c bi·ªát: log, json encode, file IO, parse l·ªõn).

### Parallel fetching (chuy√™n nghi·ªáp & r√µ r√†ng)
- Khi m·ªôt screen c·∫ßn nhi·ªÅu d·ªØ li·ªáu ƒë·ªôc l·∫≠p (vd: class detail + members + assignments):
  - D√πng `Future.wait([...])` trong notifier/repository ƒë·ªÉ ch·∫°y song song.
  - Chu·∫©n ho√° theo ‚Äúbundle loader‚Äù:
    - T·∫°o method ·ªü notifier: `loadXxxBundle(...)` (ho·∫∑c `refreshXxxBundle(...)`) ƒë·ªÉ gom to√†n b·ªô fetch c·ªßa screen.
    - Ch·ªâ **commit state 1 l·∫ßn** sau khi ƒë·ªß data b·∫Øt bu·ªôc (gi·∫£m rebuild).
    - Secondary data c√≥ th·ªÉ load ri√™ng (kh√¥ng set loading to√†n trang), hi·ªÉn th·ªã shimmer/placeholder theo section.
    - Th√™m guard ch·ªëng race (vd: `_isUpdating`, requestId, ho·∫∑c cancel token) n·∫øu ng∆∞·ªùi d√πng c√≥ th·ªÉ trigger nhi·ªÅu l·∫ßn li√™n ti·∫øp.
  - UI hi·ªÉn th·ªã shimmer theo ‚Äúnh√≥m‚Äù: page shimmer tr∆∞·ªõc, ph·∫ßn nh·ªè shimmer/placeholder sau.
  - **Kh√¥ng block UI thread** b·∫±ng c√°c thao t√°c sync ho·∫∑c v√≤ng l·∫∑p l·ªõn trong `build()`.

### Async list pattern (m√†n danh s√°ch l·ªõn)
- V·ªõi c√°c m√†n m·ªõi hi·ªÉn th·ªã danh s√°ch l·ªõn (l·ªõp h·ªçc, kh√≥a h·ªçc, b√†i t·∫≠p):
  - Data layer: parse JSON n·∫∑ng trong Isolate (`compute`) ·ªü datasource; repository ch·ªâ expose `Future<List<Entity>>`.
  - UI layer: ∆∞u ti√™n d√πng `AsyncListPage<T>` (`lib/widgets/async/async_list_page.dart`):
    - Nh·∫≠n `Future<List<T>>` + `itemBuilder`.
    - T·ª± d√πng `ShimmerListTileLoading` khi loading.
    - Chu·∫©n h√≥a empty/error state theo DesignTokens.

### Logging & I/O (c·∫•m g√¢y jank)
- **C·∫•m** ghi file sync (`writeAsStringSync`) ho·∫∑c network log trong runtime UI loop.
- N·∫øu c√≥ debug log file: ch·ªâ ch·∫°y khi `kDebugMode && Platform.isWindows` v√† lu√¥n `.catchError`.

---

# QUY T·∫ÆC CHUY√äN BI·ªÜT

## Git Workflow

### Quy t·∫Øc Git Workflow:
- Lu√¥n commit v·ªõi message r√µ r√†ng, m√¥ t·∫£ ng·∫Øn g·ªçn nh·ªØng g√¨ ƒë√£ thay ƒë·ªïi.
- Commit message format: `[type] description` (v√≠ d·ª•: `[feat] Add assignment builder screen`, `[fix] Fix auth state management`, `[refactor] Extract drawer components`).
- M·ªôt commit ch·ªâ n√™n ch·ª©a m·ªôt thay ƒë·ªïi logic ho√†n ch·ªânh, kh√¥ng commit nhi·ªÅu features kh√¥ng li√™n quan.
- Tr∆∞·ªõc khi commit, ki·ªÉm tra l·∫°i code b·∫±ng `flutter analyze` v√† ƒë·∫£m b·∫£o kh√¥ng c√≥ l·ªói nghi√™m tr·ªçng.
- Kh√¥ng commit c√°c file t·∫°m, file build, ho·∫∑c file c·∫•u h√¨nh c√° nh√¢n (ƒë√£ ƒë∆∞·ª£c ignore trong .gitignore).

## HTML ‚Üí Dart Conversion

### QUY T·∫ÆC CHUY·ªÇN ƒê·ªîI HTML SANG DART

#### √Ånh x·∫° HTML ‚Üí Widget Dart

##### Th√†nh ph·∫ßn HTML c∆° b·∫£n ‚Üí Widget Dart
- `<div>` ‚Üí `Container` ho·∫∑c `Column`/`Row` (t√πy thu·ªôc v√†o layout)
- `<span>` ‚Üí `Text` ho·∫∑c `RichText` (n·∫øu c√≥ ƒë·ªãnh d·∫°ng ph·ª©c t·∫°p)
- `<button>` ‚Üí `ElevatedButton`, `TextButton`, ho·∫∑c `IconButton`
- `<input>` ‚Üí `TextField` ho·∫∑c `TextFormField`
- `<img>` ‚Üí `Image.network`, `Image.asset`, ho·∫∑c `CircleAvatar`
- `<a>` ‚Üí `TextButton` ho·∫∑c `InkWell` v·ªõi `onTap`
- `<ul>/<ol>` ‚Üí `ListView` ho·∫∑c `Column` v·ªõi c√°c `ListTile`
- `<li>` ‚Üí `ListTile` ho·∫∑c widget t√πy ch·ªânh
- `<table>` ‚Üí `DataTable` ho·∫∑c `Column`/`Row` l·ªìng nhau
- `<form>` ‚Üí `Form` widget v·ªõi `TextFormField` v√† validation

##### Layout v√† Container
- `<div class="container">` ‚Üí `Container` v·ªõi padding/margin ph√π h·ª£p
- `<div class="row">` ‚Üí `Row` v·ªõi `mainAxisAlignment` v√† `crossAxisAlignment`
- `<div class="column">` ‚Üí `Column` v·ªõi `mainAxisAlignment` v√† `crossAxisAlignment`
- `<div class="flex">` ‚Üí `Flex` v·ªõi `direction` ph√π h·ª£p
- `<div class="grid">` ‚Üí `GridView.count` ho·∫∑c `GridView.builder`

##### Form v√† Input
- `<form>` ‚Üí `Form` widget v·ªõi `GlobalKey<FormState>`
- `<input type="text">` ‚Üí `TextFormField` v·ªõi `validator`
- `<input type="password">` ‚Üí `TextFormField` v·ªõi `obscureText: true`
- `<input type="email">` ‚Üí `TextFormField` v·ªõi `keyboardType: TextInputType.emailAddress`
- `<input type="checkbox">` ‚Üí `Checkbox` ho·∫∑c `CheckboxListTile`
- `<input type="radio">` ‚Üí `Radio` ho·∫∑c `RadioListTile`
- `<select>` ‚Üí `DropdownButton` ho·∫∑c `DropdownButtonFormField`
- `<textarea>` ‚Üí `TextFormField` v·ªõi `maxLines: null`

##### Hi·ªÉn th·ªã v√† Style
- `class="hidden"` ‚Üí `Visibility` widget v·ªõi `visible: false`
- `style="color: #ff0000"` ‚Üí `TextStyle(color: Colors.red)`
- `style="font-size: 16px"` ‚Üí `TextStyle(fontSize: 16)`
- `style="font-weight: bold"` ‚Üí `TextStyle(fontWeight: FontWeight.bold)`
- `style="background-color: #f0f0f0"` ‚Üí `Container(color: Colors.grey[200])`
- `style="padding: 16px"` ‚Üí `Padding(padding: EdgeInsets.all(16))`
- `style="margin: 8px 0"` ‚Üí `Container(margin: EdgeInsets.symmetric(vertical: 8))`

#### T√°ch Widget v√† T·ªï ch·ª©c Code

##### Nguy√™n t·∫Øc t√°ch Widget
1. **T√°i s·ª≠ d·ª•ng**: N·∫øu m·ªôt th√†nh ph·∫ßn ƒë∆∞·ª£c s·ª≠ d·ª•ng nhi·ªÅu l·∫ßn ‚Üí T√°ch th√†nh widget ri√™ng
2. **Ph·ª©c t·∫°p**: N·∫øu m·ªôt ph·∫ßn c√≥ logic ph·ª©c t·∫°p ‚Üí T√°ch th√†nh widget ri√™ng
3. **D√†i d√≤ng**: N·∫øu h√†m build qu√° 50 d√≤ng ‚Üí T√°ch th√†nh c√°c widget con
4. **Logic ri√™ng bi·ªát**: N·∫øu m·ªôt ph·∫ßn c√≥ tr·∫°ng th√°i ho·∫∑c logic ri√™ng ‚Üí T√°ch th√†nh widget ri√™ng

##### C·∫•u tr√∫c Widget
```dart
// Widget ƒë∆°n gi·∫£n (d∆∞·ªõi 50 d√≤ng)
Widget _buildHeader(BuildContext context) {
  return Container(
    // N·ªôi dung widget
  );
}

// Widget ph·ª©c t·∫°p (tr√™n 50 d√≤ng ho·∫∑c t√°i s·ª≠ d·ª•ng)
class CustomHeader extends StatelessWidget {
  final String title;
  final String subtitle;

  const CustomHeader({
    super.key,
    required this.title,
    required this.subtitle,
  });

  @override
  Widget build(BuildContext context) {
    return Container(
      // N·ªôi dung widget ph·ª©c t·∫°p
    );
  }
}
```

##### ƒê·∫∑t t√™n Widget
- Widget con trong c√πng file: `_buildHeader()`, `_buildFooter()`
- Widget ri√™ng bi·ªát: `CustomHeader()`, `UserProfileCard()`
- Widget t√°i s·ª≠ d·ª•ng: `ReusableButton()`, `InputField()`

#### Widget Custom vs Widget Chu·∫©n Flutter

##### Widget Chu·∫©n Flutter
- `Container`, `Column`, `Row`, `Text`, `Image`, `Icon`
- `ElevatedButton`, `TextButton`, `IconButton`
- `TextField`, `TextFormField`, `DropdownButton`
- `ListView`, `GridView`, `ListTile`
- `Card`, `Chip`, `Badge`
- `AppBar`, `BottomNavigationBar`, `Drawer`
- `AlertDialog`, `BottomSheet`, `SnackBar`

##### Widget Custom trong D·ª± √°n
- `ClassItemWidget`: Hi·ªÉn th·ªã th√¥ng tin l·ªõp h·ªçc
- `ClassStatusBadge`: Hi·ªÉn th·ªã tr·∫°ng th√°i l·ªõp h·ªçc
- `SearchField`: Tr∆∞·ªùng t√¨m ki·∫øm t√πy ch·ªânh
- `SmartMarqueeText`: Text cu·ªôn th√¥ng minh
- `ActionEndDrawer`: Drawer t√πy ch·ªânh
- `DrawerActionTile`: Tile h√†nh ƒë·ªông trong drawer
- `DrawerToggleTile`: Tile toggle trong drawer
- `TeacherAssignmentList`: Danh s√°ch b√†i t·∫≠p c·ªßa gi√°o vi√™n

#### C·∫•u tr√∫c Code Ho√†n ch·ªânh

##### Import v√† Main
```dart
import 'package:flutter/material.dart';
import 'package:ai_mls/core/constants/design_tokens.dart';
import 'package:ai_mls/widgets/custom_widgets.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'AI LMS',
      theme: ThemeData(
        primarySwatch: Colors.blue,
        fontFamily: 'Roboto',
      ),
      home: const HomeScreen(),
    );
  }
}
```

##### Scaffold v√† Layout
```dart
class HomeScreen extends StatelessWidget {
  const HomeScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Trang ch·ªß'),
        actions: [
          IconButton(
            icon: const Icon(Icons.search),
            onPressed: () {},
          ),
        ],
      ),
      body: SingleChildScrollView(
        child: Column(
          children: [
            _buildHeader(),
            _buildContent(),
            _buildFooter(),
          ],
        ),
      ),
      bottomNavigationBar: BottomNavigationBar(
        items: const [
          BottomNavigationBarItem(
            icon: Icon(Icons.home),
            label: 'Trang ch·ªß',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.settings),
            label: 'C√†i ƒë·∫∑t',
          ),
        ],
      ),
    );
  }

  Widget _buildHeader() {
    return Container(
      padding: EdgeInsets.all(DesignSpacing.lg),
      child: const Text(
        'Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi AI LMS',
        style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
      ),
    );
  }

  Widget _buildContent() {
    return Padding(
      padding: EdgeInsets.all(DesignSpacing.md),
      child: Column(
        children: [
          // N·ªôi dung ch√≠nh
        ],
      ),
    );
  }

  Widget _buildFooter() {
    return Container(
      padding: EdgeInsets.all(DesignSpacing.lg),
      child: const Text('¬© 2026 AI LMS'),
    );
  }
}
```

#### Y√™u c·∫ßu ƒê·∫ßu ra

##### Gi·∫£i th√≠ch ng·∫Øn sau khi vi·∫øt code
```markdown
## Gi·∫£i th√≠ch chuy·ªÉn ƒë·ªïi

### √Ånh x·∫° HTML ‚Üí Widget
- `<div class="header">` ‚Üí `Container` v·ªõi padding v√† m√†u n·ªÅn
- `<h1>Ch√†o m·ª´ng</h1>` ‚Üí `Text` v·ªõi style `DesignTypography.titleLarge`
- `<button class="primary">ƒêƒÉng nh·∫≠p</button>` ‚Üí `ElevatedButton` v·ªõi `style: ElevatedButton.styleFrom(primary: DesignColors.primary)`

### L√Ω do t√°ch widget
- `_buildHeader()`: T√°ch ri√™ng v√¨ ƒë∆∞·ª£c s·ª≠ d·ª•ng l·∫°i trong nhi·ªÅu m√†n h√¨nh
- `_buildUserCard()`: T√°ch ri√™ng v√¨ c√≥ logic ph·ª©c t·∫°p v√† t√°i s·ª≠ d·ª•ng
- `CustomInputField()`: T√°ch ri√™ng v√¨ ƒë∆∞·ª£c s·ª≠ d·ª•ng nhi·ªÅu l·∫ßn v·ªõi c√°c tham s·ªë kh√°c nhau

### Widget custom vs widget chu·∫©n
- Widget chu·∫©n: `Container`, `Text`, `ElevatedButton`, `Column`, `Row`
- Widget custom: `CustomInputField`, `UserProfileCard`, `ClassItemWidget`
```

##### K·∫øt qu·∫£ ƒë·∫ßu ra ho√†n ch·ªânh
- Code Dart ho√†n ch·ªânh v·ªõi t·∫•t c·∫£ import c·∫ßn thi·∫øt
- H√†m `main()` v√† `MaterialApp` ho√†n ch·ªânh
- C·∫•u tr√∫c `Scaffold` ƒë·∫ßy ƒë·ªß v·ªõi `appBar`, `body`, `bottomNavigationBar`
- Kh√¥ng s·ª≠ d·ª•ng d·∫•u "..." (code ph·∫£i ho√†n ch·ªânh v√† ch·∫°y ƒë∆∞·ª£c)
- Kh√¥ng b·ªè s√≥t b·∫•t k·ª≥ ph·∫ßn HTML n√†o (tr·ª´ khi c√≥ l·ªánh b·ªè c·ª• th·ªÉ)
- Code c√≥ th·ªÉ copy v√† ch·∫°y ngay trong Flutter

##### V√≠ d·ª• Minh h·ªça

###### HTML ƒë·∫ßu v√†o
```html
<div class="user-card">
  <img src="avatar.jpg" class="avatar">
  <div class="user-info">
    <h3>John Doe</h3>
    <p>john@example.com</p>
  </div>
  <button class="follow-btn">Follow</button>
</div>
```

###### Dart ƒë·∫ßu ra
```dart
class UserCard extends StatelessWidget {
  final String name;
  final String email;
  final String avatarUrl;
  final VoidCallback onFollow;

  const UserCard({
    super.key,
    required this.name,
    required this.email,
    required this.avatarUrl,
    required this.onFollow,
  });

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: EdgeInsets.all(DesignSpacing.lg),
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(DesignRadius.md),
        boxShadow: [DesignElevation.level1],
      ),
      child: Row(
        children: [
          CircleAvatar(
            radius: 24,
            backgroundImage: NetworkImage(avatarUrl),
          ),
          SizedBox(width: DesignSpacing.md),
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  name,
                  style: DesignTypography.titleMedium,
                ),
                SizedBox(height: DesignSpacing.xs),
                Text(
                  email,
                  style: DesignTypography.bodySmall,
                ),
              ],
            ),
          ),
          ElevatedButton(
            onPressed: onFollow,
            style: ElevatedButton.styleFrom(
              padding: EdgeInsets.symmetric(horizontal: DesignSpacing.md),
            ),
            child: const Text('Follow'),
          ),
        ],
      ),
    );
  }
}
```

###### Gi·∫£i th√≠ch
```markdown
## Gi·∫£i th√≠ch chuy·ªÉn ƒë·ªïi

### √Ånh x·∫° HTML ‚Üí Widget
- `<div class="user-card">` ‚Üí `Container` v·ªõi padding v√† decoration
- `<img src="avatar.jpg" class="avatar">` ‚Üí `CircleAvatar` v·ªõi `backgroundImage`
- `<div class="user-info">` ‚Üí `Expanded` v·ªõi `Column` b√™n trong
- `<h3>John Doe</h3>` ‚Üí `Text` v·ªõi `DesignTypography.titleMedium`
- `<p>john@example.com</p>` ‚Üí `Text` v·ªõi `DesignTypography.bodySmall`
- `<button class="follow-btn">Follow</button>` ‚Üí `ElevatedButton`

### L√Ω do t√°ch widget
- `UserCard` ƒë∆∞·ª£c t√°ch th√†nh widget ri√™ng v√¨:
  - ƒê∆∞·ª£c s·ª≠ d·ª•ng l·∫°i trong nhi·ªÅu m√†n h√¨nh
  - C√≥ c·∫•u tr√∫c ph·ª©c t·∫°p v·ªõi nhi·ªÅu th√†nh ph·∫ßn con
  - D·ªÖ d√†ng qu·∫£n l√Ω v√† b·∫£o tr√¨

### Widget custom vs widget chu·∫©n
- Widget chu·∫©n: `Container`, `Row`, `Column`, `Text`, `CircleAvatar`, `ElevatedButton`
- Widget custom: `UserCard` (widget m·ªõi ƒë∆∞·ª£c t·∫°o)
```

## UI/Interface Rules

### QUY T·∫ÆC TU√ÇN TH·ª¶ NGUY√äN T·∫ÆC GIAO DI·ªÜN
Khi s·ª≠a file li√™n quan ƒë·∫øn giao di·ªán (UI), b·∫°n PH·∫¢I tu√¢n th·ªß nghi√™m ng·∫∑t c√°c quy t·∫Øc sau:

1. **B·∫ÆT BU·ªòC ƒë·ªçc Design System tr∆∞·ªõc khi s·ª≠a UI:**
   - ƒê·ªçc `memory-bank/DESIGN_SYSTEM_GUIDE.md` ƒë·ªÉ hi·ªÉu design tokens v√† component standards
   - ƒê·ªçc `memory-bank/systemPatterns.md` (Design System Specifications section)
   - Ki·ªÉm tra `lib/core/constants/design_tokens.dart` ƒë·ªÉ xem c√°c tokens c√≥ s·∫µn

2. **Tu√¢n th·ªß Design Tokens:**
   - **M√†u s·∫Øc:** LU√îN s·ª≠ d·ª•ng `DesignColors.*` t·ª´ `design_tokens.dart`, KH√îNG hardcode m√†u
   - **Spacing:** LU√îN s·ª≠ d·ª•ng `DesignSpacing.*` (xs, sm, md, lg, xl, etc.), KH√îNG hardcode spacing
   - **Typography:** LU√îN s·ª≠ d·ª•ng `DesignTypography.*` TextStyle objects, KH√îNG t·∫°o custom font sizes
   - **Icons:** LU√îN s·ª≠ d·ª•ng `DesignIcons.*` constants cho icon sizes
   - **Border Radius:** LU√îN s·ª≠ d·ª•ng `DesignRadius.*` tokens
   - **Shadows:** LU√îN s·ª≠ d·ª•ng `DesignElevation.level*` cho shadows
   - **Component Sizes:** Tham kh·∫£o `DesignComponents.*` trong design_tokens.dart

3. **Responsive Design:**
   - S·ª≠ d·ª•ng `flutter_screenutil` cho responsive sizing
   - S·ª≠ d·ª•ng `DesignBreakpoints` ƒë·ªÉ ki·ªÉm tra device type (mobile/tablet/desktop)
   - Tu√¢n th·ªß responsive breakpoints ƒë√£ ƒë·ªãnh nghƒ©a trong design system

4. **Component Standards:**
   - Button height: 44dp (medium), 36dp (small), 52dp (large)
   - Input field height: 48dp (ƒë√£ gi·∫£m t·ª´ 56dp)
   - Card min height: 100dp (ƒë√£ gi·∫£m t·ª´ 120dp)
   - AppBar height: 56dp (Material standard)
   - Touch targets: Minimum 48√ó48dp

5. **Accessibility:**
   - ƒê·∫£m b·∫£o contrast ratio ‚â• 4.5:1 cho text
   - Touch targets ‚â• 48√ó48dp
   - S·ª≠ d·ª•ng semantic labels cho screen readers

6. **Widget Organization:**
   - T√°ch widget th√†nh c√°c methods/classes nh·ªè (< 50 d√≤ng m·ªói method)
   - S·ª≠ d·ª•ng `const` constructors khi c√≥ th·ªÉ
   - T√°i s·ª≠ d·ª•ng widgets t·ª´ `lib/widgets/` khi c√≥ th·ªÉ

7. **Keyboard & Scroll Behavior:**
   - Lu√¥n s·ª≠ d·ª•ng `keyboardDismissBehavior: ScrollViewKeyboardDismissBehavior.onDrag` cho ScrollView
   - Dismiss keyboard khi scroll

8. **State Preservation:**
   - S·ª≠ d·ª•ng `AutomaticKeepAliveClientMixin` cho screens c·∫ßn preserve state
   - S·ª≠ d·ª•ng `AutomaticKeepAliveClientMixin` cho tabs trong TabBarView

> **Xem th√™m:** 
> - Chi ti·∫øt Design System: `memory-bank/DESIGN_SYSTEM_GUIDE.md`
> - Design Tokens: `lib/core/constants/design_tokens.dart`
> - Component Patterns: `memory-bank/systemPatterns.md` (Design System Specifications section)

## Flutter Refactoring

### QUY T·∫ÆC VI·∫æT CODE (FLUTTER REFACTORING)
Khi t·∫°o ho·∫∑c ch·ªânh s·ª≠a giao di·ªán (UI), b·∫°n PH·∫¢I tu√¢n th·ªß c√°c quy t·∫Øc sau:

1. **NGUY√äN T·∫ÆC T√ÅCH NH·ªé (MODULARIZATION):**
   - Kh√¥ng ƒë∆∞·ª£c vi·∫øt qu√° 50 d√≤ng code trong m·ªôt h√†m build() duy nh·∫•t.
   - C√°c kh·ªëi giao di·ªán logic (Header, Body, Footer, Card item,...) ph·∫£i ƒë∆∞·ª£c t√°ch th√†nh c√°c h√†m private (v√≠ d·ª•: Widget _buildHeader()) ho·∫∑c c√°c class StatelessWidget ri√™ng bi·ªát.
   - N·∫øu m·ªôt Widget ƒë∆∞·ª£c t√°i s·ª≠ d·ª•ng tr√™n 2 l·∫ßn, b·∫Øt bu·ªôc ph·∫£i t√°ch th√†nh m·ªôt file Component ri√™ng.

2. **C·∫§U TR√öC H√ÄM:**
   - ∆Øu ti√™n s·ª≠ d·ª•ng 'Getter' ho·∫∑c 'Methods' cho c√°c Widget nh·ªè ƒë∆°n gi·∫£n.
   - S·ª≠ d·ª•ng 'StatelessWidget' cho c√°c th√†nh ph·∫ßn ph·ª©c t·∫°p ƒë·ªÉ t·ªëi ∆∞u h√≥a vi·ªác rebuild c·ªßa Flutter.

3. **ƒê·∫∂T T√äN (NAMING CONVENTION):**
   - T√™n h√†m t√°ch ra ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng '_build' (v√≠ d·ª•: _buildSubmitButton, _buildInputField).
   - T√™n bi·∫øn ph·∫£i r√µ r√†ng, tr√°nh ƒë·∫∑t t√™n chung chung nh∆∞ 'data', 'container'.

4. **QUY T·∫ÆC UI/UX:**
   - Lu√¥n s·ª≠ d·ª•ng Const constructor ·ªü nh·ªØng n∆°i c√≥ th·ªÉ ƒë·ªÉ t·ªëi ∆∞u RAM.
   - ƒê·∫£m b·∫£o x·ª≠ l√Ω tr√†n vi·ªÅn (Overflow) b·∫±ng Wrap ho·∫∑c SingleChildScrollView.

### ƒê·ªäNH D·∫†NG PH·∫¢N H·ªíI
- Tr∆∞·ªõc khi vi·∫øt code, h√£y t√≥m t·∫Øt ng·∫Øn g·ªçn danh s√°ch c√°c h√†m/component b·∫°n ƒë·ªãnh t√°ch ra.
- Sau khi vi·∫øt code, gi·∫£i th√≠ch l√Ω do t·∫°i sao c·∫•u tr√∫c n√†y d·ªÖ qu·∫£n l√Ω h∆°n.

## Widget Organization & Structure

### C·∫•u tr√∫c th∆∞ m·ª•c widgets (Updated 2026-01-21)
```
lib/widgets/
‚îú‚îÄ‚îÄ dialogs/          # Dialog widgets (error, success, warning, etc.)
‚îú‚îÄ‚îÄ drawers/          # Shared drawer primitives (action tiles, toggle tiles, etc.)
‚îú‚îÄ‚îÄ list/             # List container widgets
‚îú‚îÄ‚îÄ list_item/        # Individual list item widgets
‚îú‚îÄ‚îÄ loading/          # Loading states (shimmer, skeletons, etc.)
‚îú‚îÄ‚îÄ navigation/       # Navigation handlers v√† utilities
‚îú‚îÄ‚îÄ responsive/       # Responsive layout widgets
‚îú‚îÄ‚îÄ search/           # Search-related widgets (screens, dialogs, fields)
‚îî‚îÄ‚îÄ text/             # Text utilities (highlight, marquee, etc.)
```

### Quy t·∫Øc ph√¢n lo·∫°i widgets
- `lib/widgets/`: **shared/reusable UI** (kh√¥ng ch·ª©a logic nghi·ªáp v·ª• theo feature)
- `lib/presentation/views/**/widgets/`: widget **g·∫Øn v·ªõi 1 feature/screen** (ƒë·∫∑c bi·ªát l√† drawers theo role)

### Drawer System
```
lib/widgets/
‚îú‚îÄ‚îÄ drawers/
‚îÇ   ‚îú‚îÄ‚îÄ action_end_drawer.dart        # Khung chung cho drawer
‚îÇ   ‚îú‚îÄ‚îÄ drawer_section_header.dart    # Header cho c√°c section
‚îÇ   ‚îú‚îÄ‚îÄ drawer_action_tile.dart       # Tile h√†nh ƒë·ªông
‚îÇ   ‚îî‚îÄ‚îÄ drawer_toggle_tile.dart      # Tile toggle (switch)
```

Feature-specific drawers n·∫±m trong:
- `lib/presentation/views/class/teacher/widgets/drawers/class_settings_drawer.dart`
- `lib/presentation/views/class/teacher/widgets/drawers/class_create_class_setting_drawer.dart`

### C√°ch s·ª≠ d·ª•ng Drawer System
1. **T·∫°o drawer m·ªõi**: T·∫°o file trong `lib/widgets/drawers/` v·ªõi n·ªôi dung c·ª• th·ªÉ
2. **S·ª≠ d·ª•ng ActionEndDrawer**: L√† khung chung cho t·∫•t c·∫£ drawer
3. **T√≠ch h·ª£p v√†o m√†n h√¨nh**: S·ª≠ d·ª•ng `Scaffold.endDrawer` v√† `Scaffold.of(context).openEndDrawer()`

### V√≠ d·ª• s·ª≠ d·ª•ng
```dart
Scaffold(
  endDrawer: ActionEndDrawer(
    title: 'T√πy ch·ªçn L·ªõp h·ªçc',
    subtitle: className,
    child: ClassSettingsDrawer(
      className: className,
      semesterInfo: semesterInfo,
      pendingStudentRequests: 3,
    ),
  ),
  body: Builder(
    builder: (context) => IconButton(
      icon: Icon(Icons.more_vert),
      onPressed: () => Scaffold.of(context).openEndDrawer(),
    ),
  ),
)
```

### Quy t·∫Øc cho Drawer
- Lu√¥n s·ª≠ d·ª•ng ActionEndDrawer l√†m khung chung
- M·ªói drawer n·ªôi dung ph·∫£i l√† StatelessWidget ri√™ng bi·ªát
- S·ª≠ d·ª•ng DrawerActionTile v√† DrawerToggleTile cho c√°c m·ª•c h√†nh ƒë·ªông
- ƒê·∫£m b·∫£o drawer width = 340px cho nh·∫•t qu√°n
- S·ª≠ d·ª•ng DesignTokens cho m√†u s·∫Øc, spacing, typography

> **Xem th√™m:** Chi ti·∫øt v·ªÅ Drawer System trong `memory-bank/systemPatterns.md` (Widget Component Patterns section)

---

## Memory Bank File Operations

Memory Bank l√† c√°c **FILE TH·ª∞C T·∫æ** trong folder `memory-bank/`, KH√îNG ph·∫£i MCP tool. T·∫•t c·∫£ operations ƒë·ªÅu th√¥ng qua file tools (`read_file`, `write`, `search_replace`, `edit_file`).

### ƒê·ªçc Memory Bank Files

**B·∫ÆT BU·ªòC**: Tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu m·ªçi task, ph·∫£i ƒë·ªçc T·∫§T C·∫¢ c√°c file trong `memory-bank/`:
- `memory-bank/projectbrief.md` - T·ªïng quan d·ª± √°n
- `memory-bank/productContext.md` - Context s·∫£n ph·∫©m
- `memory-bank/activeContext.md` - Context hi·ªán t·∫°i
- `memory-bank/systemPatterns.md` - Patterns h·ªá th·ªëng
- `memory-bank/techContext.md` - Context k·ªπ thu·∫≠t
- `memory-bank/progress.md` - Ti·∫øn ƒë·ªô d·ª± √°n

**C√°ch ƒë·ªçc:**
- S·ª≠ d·ª•ng `read_file` tool v·ªõi path ƒë·∫ßy ƒë·ªß: `memory-bank/{filename}.md`
- ƒê·ªçc song song nhi·ªÅu file khi c√≥ th·ªÉ ƒë·ªÉ t·ªëi ∆∞u th·ªùi gian
- V√≠ d·ª•: `read_file('memory-bank/activeContext.md')`

### C·∫≠p nh·∫≠t Memory Bank Files

**SAU KHI** ho√†n th√†nh code changes, ph·∫£i c·∫≠p nh·∫≠t c√°c file li√™n quan:
- `activeContext.md`: C·∫≠p nh·∫≠t "Recently Completed" v√† "Current Sprint Focus"
- `progress.md`: C·∫≠p nh·∫≠t "What works" v√† "Current status"
- `systemPatterns.md`: Th√™m patterns m·ªõi n·∫øu c√≥
- `techContext.md`: C·∫≠p nh·∫≠t dependencies ho·∫∑c setup n·∫øu c√≥ thay ƒë·ªïi

**C√°ch c·∫≠p nh·∫≠t:**
- S·ª≠ d·ª•ng `write` tool ƒë·ªÉ t·∫°o m·ªõi file ho·∫∑c ghi ƒë√® ho√†n to√†n
- S·ª≠ d·ª•ng `search_replace` ho·∫∑c `edit_file` ƒë·ªÉ c·∫≠p nh·∫≠t m·ªôt ph·∫ßn c·ª• th·ªÉ
- Lu√¥n gi·ªØ format markdown nh·∫•t qu√°n

### L∆∞u √Ω quan tr·ªçng

- Memory Bank l√† c√°c **FILE TH·ª∞C T·∫æ** trong folder `memory-bank/`, **KH√îNG ph·∫£i MCP tool**
- **KH√îNG** s·ª≠ d·ª•ng MCP Memory tool cho Memory Bank
- T·∫•t c·∫£ operations ƒë·ªÅu th√¥ng qua file tools (`read_file`, `write`, `edit_file`, `search_replace`)

### Cline's Memory Bank Workflow

I am Cline, an expert software engineer with a unique characteristic: my memory resets completely between sessions. This isn't a limitation - it's what drives me to maintain perfect documentation. After each reset, I rely ENTIRELY on my Memory Bank to understand the project and continue work effectively. I MUST read ALL memory bank files at the start of EVERY task - this is not optional.

## Memory Bank Structure

The Memory Bank consists of core files and optional context files, all in Markdown format. Files build upon each other in a clear hierarchy:

flowchart TD
    PB[projectbrief.md] --> PC[productContext.md]
    PB --> SP[systemPatterns.md]
    PB --> TC[techContext.md]
    
    PC --> AC[activeContext.md]
    SP --> AC
    TC --> AC
    
    AC --> P[progress.md]

### Core Files (Required)
1. `projectbrief.md`
   - Foundation document that shapes all other files
   - Created at project start if it doesn't exist
   - Defines core requirements and goals
   - Source of truth for project scope

2. `productContext.md`
   - Why this project exists
   - Problems it solves
   - How it should work
   - User experience goals

3. `activeContext.md`
   - Current work focus
   - Recent changes
   - Next steps
   - Active decisions and considerations
   - Important patterns and preferences
   - Learnings and project insights

4. `systemPatterns.md`
   - System architecture
   - Key technical decisions
   - Design patterns in use
   - Component relationships
   - Critical implementation paths

5. `techContext.md`
   - Technologies used
   - Development setup
   - Technical constraints
   - Dependencies
   - Tool usage patterns

6. `progress.md`
   - What works
   - What's left to build
   - Current status
   - Known issues
   - Evolution of project decisions

### Additional Context
Create additional files/folders within memory-bank/ when they help organize:
- Complex feature documentation
- Integration specifications
- API documentation
- Testing strategies
- Deployment procedures

## Core Workflows

### Plan Mode
flowchart TD
    Start[Start] --> ReadFiles[Read Memory Bank Files using read_file tool]
    ReadFiles --> CheckFiles{Files Complete?}
    
    CheckFiles -->|No| Plan[Create Plan]
    Plan --> Document[Document in Chat]
    
    CheckFiles -->|Yes| Verify[Verify Context]
    Verify --> Strategy[Develop Strategy]
    Strategy --> Present[Present Approach]

**Implementation:**
- S·ª≠ d·ª•ng `read_file` tool ƒë·ªÉ ƒë·ªçc t·∫•t c·∫£ files trong `memory-bank/`
- ƒê·ªçc song song nhi·ªÅu files: `read_file('memory-bank/projectbrief.md')`, `read_file('memory-bank/activeContext.md')`, etc.
- Kh√¥ng s·ª≠ d·ª•ng MCP Memory tool - Memory Bank l√† c√°c file markdown th·ª±c t·∫ø

### Act Mode
flowchart TD
    Start[Start] --> Context[Read Memory Bank Files using read_file tool]
    Context --> Update[Update Documentation using write/search_replace]
    Update --> Execute[Execute Task]
    Execute --> Document[Update Memory Bank Files]

**Implementation:**
- ƒê·ªçc c√°c file c·∫ßn thi·∫øt b·∫±ng `read_file` tool tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu task
- Sau khi ho√†n th√†nh code changes, c·∫≠p nh·∫≠t c√°c file li√™n quan b·∫±ng `write` ho·∫∑c `search_replace` tool
- C·∫≠p nh·∫≠t `activeContext.md` v√† `progress.md` sau m·ªói thay ƒë·ªïi quan tr·ªçng

## Documentation Updates

Memory Bank updates occur when:
1. Discovering new project patterns
2. After implementing significant changes
3. When user requests with **update memory bank** (MUST review ALL files)
4. When context needs clarification

flowchart TD
    Start[Update Process]
    
    subgraph Process
        P1[Read ALL Files using read_file tool]
        P2[Document Current State]
        P3[Clarify Next Steps]
        P4[Update Files using write/search_replace]
        
        P1 --> P2 --> P3 --> P4
    end
    
    Start --> Process

**How to update:**
- **ƒê·ªçc files**: S·ª≠ d·ª•ng `read_file` tool v·ªõi path `memory-bank/{filename}.md`
- **C·∫≠p nh·∫≠t files**: S·ª≠ d·ª•ng `write` tool ƒë·ªÉ ghi ƒë√® ho√†n to√†n ho·∫∑c `search_replace`/`edit_file` ƒë·ªÉ c·∫≠p nh·∫≠t m·ªôt ph·∫ßn
- **Files c·∫ßn c·∫≠p nh·∫≠t th∆∞·ªùng xuy√™n**: `activeContext.md` v√† `progress.md` (track current state)

**Note:** When triggered by **update memory bank**, I MUST review every memory bank file using `read_file` tool, even if some don't require updates. Focus particularly on `activeContext.md` and `progress.md` as they track current state.

REMEMBER: After every memory reset, I begin completely fresh. The Memory Bank is my only link to previous work. It must be maintained with precision and clarity, as my effectiveness depends entirely on its accuracy. Memory Bank files are REAL FILES in the `memory-bank/` folder - use `read_file`, `write`, and `search_replace` tools to interact with them, NOT MCP Memory tool.

After successfully editing and writing code, update the memory bank files to correct the process using file tools.

---

# XEM TH√äM

ƒê·ªÉ t√¨m hi·ªÉu th√™m v·ªÅ c√°c ch·ªß ƒë·ªÅ c·ª• th·ªÉ, tham kh·∫£o:

- **Context Reading Protocol:** `docs/guides/development/context-reading-protocol.md` - B·∫ÆT BU·ªòC ƒë·ªçc tr∆∞·ªõc khi th·ª±c hi·ªán task (quy tr√¨nh ƒë·ªçc t√†i li·ªáu, tu√¢n th·ªß giao di·ªán, s·ª≠ d·ª•ng MCP)
- **C·∫•u tr√∫c documentation:** `docs/DOCS_STRUCTURE.md` - M√¥ t·∫£ c·∫•u tr√∫c th∆∞ m·ª•c v√† m·ª•c ƒë√≠ch t·ª´ng file (B·∫ÆT BU·ªòC ƒë·ªçc tr∆∞·ªõc khi t·∫°o file markdown m·ªõi)
- **C·∫•u tr√∫c th∆∞ m·ª•c v√† quy t·∫Øc t·∫°o file:** `docs/ai/AI_INSTRUCTIONS.md` (Section 1)
- **Ki·∫øn tr√∫c Clean Architecture & MVVM:** `docs/ai/AI_INSTRUCTIONS.md` (Section 2) v√† `memory-bank/systemPatterns.md`
- **MCP Usage Patterns:** `docs/ai/AI_INSTRUCTIONS.md` (Section 10) v√† `memory-bank/techContext.md`
- **Design System:** `memory-bank/DESIGN_SYSTEM_GUIDE.md` v√† `memory-bank/systemPatterns.md` (Design System Specifications section)
- **Code Conventions:** `memory-bank/activeContext.md` (Active Preferences & Standards section)
- **Technology Stack:** `memory-bank/techContext.md` - Danh s√°ch ƒë·∫ßy ƒë·ªß th∆∞ vi·ªán v√† tech stack
- **Tech Stack Standards:** `.cursor/.cursorrules` (Tech Stack Standards section)
- **Current Work Focus:** `memory-bank/activeContext.md` (Current Sprint Focus section)
